<!DOCTYPE html>
<html lang="en-nz">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta itemprop="name" content="Smart Date Picker: Selecting and bumping dates">
<meta itemprop="description" content="This is a direct continuation of the last post on using FRP primitives to model changing the period type. I will jump straight into the next part of adding more smart date picker functionality. You might want to review the entire series on making a smart date picker if this is your first visit."><meta itemprop="datePublished" content="2016-07-24T13:18:33&#43;12:00" />
<meta itemprop="dateModified" content="2016-07-24T13:18:33&#43;12:00" />
<meta itemprop="wordCount" content="823">
<meta itemprop="keywords" content="" /><meta property="og:title" content="Smart Date Picker: Selecting and bumping dates" />
<meta property="og:description" content="This is a direct continuation of the last post on using FRP primitives to model changing the period type. I will jump straight into the next part of adding more smart date picker functionality. You might want to review the entire series on making a smart date picker if this is your first visit." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/smart-date-picker-selecting-and-bumping-dates/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-07-24T13:18:33&#43;12:00" />
<meta property="article:modified_time" content="2016-07-24T13:18:33&#43;12:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Smart Date Picker: Selecting and bumping dates"/>
<meta name="twitter:description" content="This is a direct continuation of the last post on using FRP primitives to model changing the period type. I will jump straight into the next part of adding more smart date picker functionality. You might want to review the entire series on making a smart date picker if this is your first visit."/>

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/favicon.ico">

	<title>Smart Date Picker: Selecting and bumping dates</title>
	<link rel="stylesheet" href="/css/style.min.f74778e3020c87c304fb5982e09b92ba63a5c7f202996d4c7283d6057acfe9c1.css" integrity="sha256-90d44wIMh8ME+1mC4JuSumOlx/ICmW1McoPWBXrP6cE=" crossorigin="anonymous">
	<style>.bg-img {background-image: url('/wp-content/uploads/sites/2/2016/06/they-fled-the-setting-sun-henk-sijgers.jpg');}</style>
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="/">Coder Frontline</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					
				<a href="/posts/">Posts</a>
				<a href="/categories/">Categories</a>

				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<button id="img-btn" class="hdr-btn" title="Featured Image"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-image"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg></button><span class="hdr-social hide-in-mobile"><a href="https://www.linkedin.com/in/shawnlamnz" target="_blank" rel="noopener me" title="Linkedin"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a><a href="https://github.com/zemien" target="_blank" rel="noopener me" title="Github"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a></span><button id="menu-btn" class="hdr-btn" title="Menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="/posts/">Posts</a></li>
			<li><a href="/categories/">Categories</a></li>
		</ul>
	</div>


	<div class="bg-img"></div>
	<main class="site-main section-inner animated fadeIn faster">
		<article class="thin">
			<header class="post-header">
				<div class="post-meta"><span>Jul 24, 2016</span></div>
				<h1>Smart Date Picker: Selecting and bumping dates</h1>
			</header>
			<div class="content">
				<p>This is a direct continuation of the <a href="/smart-date-picker-period-type-frp-primitives/">last post on using FRP primitives</a> to model changing the period type. I will jump straight into the next part of adding more smart date picker functionality. You might want to review the <a href="/?s=smart+date+picker">entire series</a> on making a smart date picker if this is your first visit.</p>
<h2 id="code-on-github">Code on GitHub<a href="#code-on-github" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>This week’s fully-functional code is up on the <a href="https://github.com/zemien/smart-date-picker">GitHub project</a>, under the 02 – Date Range Picker folder. Each folder corresponds to a week’s post and is self-contained. You will need a .Net 4.6.1 compiler to be able to build and run the project.</p>
<h2 id="data-availability-dates">Data Availability Dates<a href="#data-availability-dates" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>One of the control’s external data source is the dates that the system has data for. I am modelling it in a simple way in this exercise by way of a service class. This DataAvailabilityService exposes a Cell of a DateRange. A DateRange is an immutable struct that contains a start and end DateTime. Immutability is an important concept in functional programming, and a good practice to consider in general.</p>
<p>I use a CellSink in this class. A CellSink and StreamSink are the primary ways to sending data into FRP logic. They extend a Cell or Stream with a send() method that pushes data into FRP-land. There is no other way to instantiate a Cell or a Stream without going through the sinks.</p>
<p>In my simple service I have initialised the CellSink with a default value, but I’ve also added a method that simulates fetching new dates from the external world. I am not using this bit yet so we can ignore this for now.</p>
<div class="highlight"><pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">DataAvailabilityService</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">CellSink</span><span class="p">&lt;</span><span class="n">DateRange</span><span class="p">&gt;</span> <span class="n">mDataAvailabilitySink</span><span class="p">;</span>

    <span class="c1">/// &lt;summary&gt;
</span><span class="c1"></span>    <span class="c1">/// Initializes a Data Availability Service
</span><span class="c1"></span>    <span class="c1">/// &lt;/summary&gt;
</span><span class="c1"></span>    <span class="k">public</span> <span class="n">DataAvailabilityService</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">mDataAvailabilitySink</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CellSink</span><span class="p">&lt;</span><span class="n">DateRange</span><span class="p">&gt;(</span><span class="k">new</span> <span class="n">DateRange</span><span class="p">(</span><span class="k">new</span> <span class="n">DateTime</span><span class="p">(</span><span class="m">2014</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span> <span class="k">new</span> <span class="n">DateTime</span><span class="p">(</span><span class="m">2016</span><span class="p">,</span> <span class="m">07</span><span class="p">,</span> <span class="m">31</span><span class="p">)));</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt;
</span><span class="c1"></span>    <span class="c1">/// Dates that we can run reports for
</span><span class="c1"></span>    <span class="c1">/// &lt;/summary&gt;
</span><span class="c1"></span>    <span class="k">public</span> <span class="n">Cell</span><span class="p">&lt;</span><span class="n">DateRange</span><span class="p">&gt;</span> <span class="n">DataAvailability</span>
    <span class="p">{</span>
        <span class="k">get</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">mDataAvailabilitySink</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h2 id="adding-date-pickers">Adding date pickers<a href="#adding-date-pickers" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Once again I am using the SWidget library from the <a href="https://github.com/SodiumFRP/sodium">Sodium FRP library</a> book examples. It includes a rudimentary date picker control that consists of three combo boxes, instead of a fancy calendar picker. It exposes a SelectedDate Cell property, which contains the user-selected date.</p>
<h2 id="lift-frp-primitive">lift() FRP primitive<a href="#lift-frp-primitive" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>lift() is another FRP primitive that works like map() and merge() for multiple cells – you provide a function that combines multiple cells into one. It is called ‘lift’ “because we are ‘lifting’ a function that operates on values into the world of cells.” It is a general functional programming concept that I am still not familiar with.</p>
<h2 id="the-bump-dates-function">The bump dates function<a href="#the-bump-dates-function" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Alright – let’s bring all those Cells together and make a smart date picker, shall we? We now have the following Cells:</p>
<ul>
<li>StartDate</li>
<li>EndDate</li>
<li>DataAvailability</li>
<li>PeriodType</li>
</ul>
<p>As mentioned, we will use the lift() function to combine all those cells and output a DateRange.</p>
<div class="highlight"><pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="c1">//Combine the different cells into one DateRange using a Lift() call to BumpDates()
</span><span class="c1"></span><span class="n">Cell</span><span class="p">&lt;</span><span class="n">DateRange</span><span class="p">&gt;</span> <span class="n">cDateRange</span> <span class="p">=</span> <span class="n">startDateField</span><span class="p">.</span><span class="n">SelectedDate</span><span class="p">.</span><span class="n">Lift</span><span class="p">(</span>
    <span class="n">endDateField</span><span class="p">.</span><span class="n">SelectedDate</span><span class="p">,</span> <span class="n">dataAvailabilityService</span><span class="p">.</span><span class="n">DataAvailability</span><span class="p">,</span> 
    <span class="n">cPeriodTypeCell</span><span class="p">,</span> <span class="n">ReportDateRangeBumper</span><span class="p">.</span><span class="n">BumpDates</span><span class="p">);</span>
</code></pre></div><p>The last method argument is a method I’ve defined in a separate helper class.</p>
<h2 id="date-bumping-helper-function">Date bumping helper function<a href="#date-bumping-helper-function" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>ReportDateRangeBumper is a helper class that is the logical ham in this FRP sandwich. I won’t go into details as it’s pretty simple once you read it. What’s important is how simple it is – it doesn’t maintain state or have external dependencies. This retains referential transparency and also makes it easy to unit test. In other words, it will always return the same result with the same input parameters.</p>
<p>This is a massive improvement over the non-FRP way of doing things. Previously, I had logic scattered in various event handlers that made it impractical to unit test. I also could not guarantee the order of the events.</p>
<h2 id="displaying-the-bumped-dates">Displaying the bumped dates<a href="#displaying-the-bumped-dates" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Finally, I display the bumped dates by using another map() call to convert the DateRange to a string representation. I add this to a SLabel control on the screen.</p>
<div class="highlight"><pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="n">SLabel</span> <span class="n">selectedDate</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SLabel</span><span class="p">(</span><span class="n">cDateRange</span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="n">dr</span> <span class="p">=&gt;</span> <span class="n">dr</span><span class="p">.</span><span class="n">ToString</span><span class="p">()));</span>

<span class="c1">//Some other code
</span><span class="c1"></span>
<span class="n">ResultsContainer</span><span class="p">.</span><span class="n">Children</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">selectedDate</span><span class="p">);</span>
</code></pre></div><h2 id="next-steps">Next steps<a href="#next-steps" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>There are a few important things I still need to figure out. I’ve added TODO notes throughout the code.</p>
<ul>
<li>Differentiate between changing the start date vs. the end date picker.</li>
<li>Update the SDateField once I’ve bumped the selected dates.</li>
<li>Simulate changing data availabilities while the program is running.</li>
</ul>
<p>Comments on how to achieve those will be much appreciated!</p>
<p><em>This is part of an ongoing series where I review the book</em><a href="https://www.manning.com/books/functional-reactive-programming"> <em>Functional Reactive Programming by Stephen Blackheath and Anthony Jones</em></a><em>. Kindly note that anything I write here may be incorrect and not indicative of the author’s intent. After all, making mistakes is the mother of learning and this book review is meant to be a truthful reflection of my own experiences grasping a new concept. The review copy I received was version 11 in their Manning’s Early Access Program, so the book’s contents may differ at the time of publication.</em></p>
			</div>
			<hr class="post-end">
			<footer class="post-info">
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>823 Words</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2016-07-24 13:18 &#43;1200</p>
			</footer>
		</article>
		<div class="post-nav thin">
			<a class="next-post" href="/two-week-posting-hiatus/">
				<span class="post-nav-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>&nbsp;Newer</span><br><span>Two Week Posting Hiatus</span>
			</a>
			<a class="prev-post" href="/smart-date-picker-changing-the-period-type-using-frp-primitives/">
				<span class="post-nav-label">Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><br><span>Smart Date Picker: Changing the period type using FRP Primitives</span>
			</a>
		</div>
		<div id="comments" class="thin">
</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2021 <a href="/">Shawn Lam</a> &#183; <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></p>
		<p>
			Made with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> &#183; Theme <a href="https://github.com/Track3/hermit" target="_blank" rel="noopener">Hermit</a> &#183; <a href="/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
		</p>
	</footer>



	<script src="/js/bundle.min.7d8545daa55d62427355498dd8da13f98ff79a7938ce7d2a5e2ae1ec0de3beb8.js" integrity="sha256-fYVF2qVdYkJzVUmN2NoT+Y/3mnk4zn0qXirh7A3jvrg=" crossorigin="anonymous"></script>
	
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-74441668-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</body>

</html>
