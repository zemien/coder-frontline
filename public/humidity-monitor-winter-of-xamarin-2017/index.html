<!DOCTYPE html>
<html lang="en-nz">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta itemprop="name" content="Humidity Monitor - Winter of Xamarin 2017">
<meta itemprop="description" content="I&rsquo;m delighted to announce that I won Microsoft&rsquo;s Winter of Xamarin competition this year with my Humidity Monitor App. Here&rsquo;s my submission video:
The sanitised source code (with the keys and connection strings removed) is on my GitHub repo. Here&rsquo;s a rough guide on how you can replicate the project and some ideas to extend it further:
Pre-requisites  A Raspberry Pi 3 running Windows 10 IoT Sense HAT module Recommended: 40-pin GPIO ribbon cable to keep some distance between the Pi and the Sense HAT because the Pi&rsquo;s hot running temperature will affect Sense HAT readings (Optional) A Belkin WeMo Smart Switch or alternative smart switch that can connect to IFTTT (Optional) A dehumidifier that can be turned on from the switch (i."><meta itemprop="datePublished" content="2017-06-28T23:42:47&#43;12:00" />
<meta itemprop="dateModified" content="2017-06-28T23:42:47&#43;12:00" />
<meta itemprop="wordCount" content="1478">
<meta itemprop="keywords" content="" /><meta property="og:title" content="Humidity Monitor - Winter of Xamarin 2017" />
<meta property="og:description" content="I&rsquo;m delighted to announce that I won Microsoft&rsquo;s Winter of Xamarin competition this year with my Humidity Monitor App. Here&rsquo;s my submission video:
The sanitised source code (with the keys and connection strings removed) is on my GitHub repo. Here&rsquo;s a rough guide on how you can replicate the project and some ideas to extend it further:
Pre-requisites  A Raspberry Pi 3 running Windows 10 IoT Sense HAT module Recommended: 40-pin GPIO ribbon cable to keep some distance between the Pi and the Sense HAT because the Pi&rsquo;s hot running temperature will affect Sense HAT readings (Optional) A Belkin WeMo Smart Switch or alternative smart switch that can connect to IFTTT (Optional) A dehumidifier that can be turned on from the switch (i." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/humidity-monitor-winter-of-xamarin-2017/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-06-28T23:42:47&#43;12:00" />
<meta property="article:modified_time" content="2017-06-28T23:42:47&#43;12:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Humidity Monitor - Winter of Xamarin 2017"/>
<meta name="twitter:description" content="I&rsquo;m delighted to announce that I won Microsoft&rsquo;s Winter of Xamarin competition this year with my Humidity Monitor App. Here&rsquo;s my submission video:
The sanitised source code (with the keys and connection strings removed) is on my GitHub repo. Here&rsquo;s a rough guide on how you can replicate the project and some ideas to extend it further:
Pre-requisites  A Raspberry Pi 3 running Windows 10 IoT Sense HAT module Recommended: 40-pin GPIO ribbon cable to keep some distance between the Pi and the Sense HAT because the Pi&rsquo;s hot running temperature will affect Sense HAT readings (Optional) A Belkin WeMo Smart Switch or alternative smart switch that can connect to IFTTT (Optional) A dehumidifier that can be turned on from the switch (i."/>

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/favicon.ico">

	<title>Humidity Monitor - Winter of Xamarin 2017</title>
	<link rel="stylesheet" href="/css/style.min.f74778e3020c87c304fb5982e09b92ba63a5c7f202996d4c7283d6057acfe9c1.css" integrity="sha256-90d44wIMh8ME+1mC4JuSumOlx/ICmW1McoPWBXrP6cE=" crossorigin="anonymous">
	<style>.bg-img {background-image: url('/wp-content/uploads/sites/2/2017/06/mountain-ridge-pathways-snow-hike.jpg');}</style>
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="/">Coder Frontline</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					
				<a href="/posts/">Posts</a>
				<a href="/categories/">Categories</a>

				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<button id="img-btn" class="hdr-btn" title="Featured Image"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-image"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg></button><span class="hdr-social hide-in-mobile"><a href="https://www.linkedin.com/in/shawnlamnz" target="_blank" rel="noopener me" title="Linkedin"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a><a href="https://github.com/zemien" target="_blank" rel="noopener me" title="Github"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a></span><button id="menu-btn" class="hdr-btn" title="Menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="/posts/">Posts</a></li>
			<li><a href="/categories/">Categories</a></li>
		</ul>
	</div>


	<div class="bg-img"></div>
	<main class="site-main section-inner animated fadeIn faster">
		<article class="thin">
			<header class="post-header">
				<div class="post-meta"><span>Jun 28, 2017</span></div>
				<h1>Humidity Monitor - Winter of Xamarin 2017</h1>
			</header>
			<div class="content">
				<p>I&rsquo;m delighted to announce that I won Microsoft&rsquo;s Winter of Xamarin competition this year with my Humidity Monitor App. Here&rsquo;s my submission video:</p>
<p>The sanitised source code (with the keys and connection strings removed) is on <a href="https://github.com/zemien/HumidityMonitor">my GitHub repo</a>. Here&rsquo;s a rough guide on how you can replicate the project and some ideas to extend it further:</p>
<h1 id="pre-requisites">Pre-requisites<a href="#pre-requisites" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>
<ul>
<li>A <a href="https://pishop.nz/RPI3-COMBO-1/">Raspberry Pi 3</a> running <a href="https://developer.microsoft.com/en-us/windows/iot/downloads">Windows 10 IoT</a></li>
<li><a href="https://www.pbtech.co.nz/product/SEVRBP0073/Raspberry-Pi-Official-Sense-HAT-with-Orientation-P">Sense HAT</a> module</li>
<li>Recommended: <a href="https://pishop.nz/RPI-DUPONT/">40-pin GPIO ribbon cable</a> to keep some distance between the Pi and the Sense HAT because the Pi&rsquo;s hot running temperature will affect Sense HAT readings</li>
<li>(Optional) A Belkin WeMo Smart Switch or alternative smart switch that can connect to IFTTT</li>
<li>(Optional) A dehumidifier that can be turned on from the switch (i.e. does not require additional button presses on the device)</li>
<li>(Optional) A free If This Then That (<a href="https://ifttt.com">IFTTT</a>) account</li>
<li>Windows 10 PC or laptop is required to build Universal Windows Platform (UWP) apps, which is the platform Windows 10 IoT uses. A Mac OS computer can be used for all other development tasks in this project.</li>
<li><a href="https://www.visualstudio.com/downloads/">Visual Studio 2017</a> (Windows or Mac) Community Edition and above. Make sure to choose UWP Development and Mobile Development options when installing.</li>
<li><a href="https://www.syncfusion.com/products/xamarin">Syncfusion Essential Studio for Xamarin</a>: Syncfusion generously offers free <a href="https://www.syncfusion.com/products/communitylicense">community licenses</a> for individual developers and small organisations.</li>
<li>An <a href="https://azure.microsoft.com/en-us/">Azure</a> subscription. I stick to free tiers where possible. The only thing I am paying for is Azure Table Storage and it costs about $0.01 a month even after my sensor has been uploading data for a month.
<ul>
<li>Join the <a href="https://www.visualstudio.com/dev-essentials/">Visual Studio Dev Essentials</a> program if you don&rsquo;t have an existing Azure subscription because it provides free Azure credits over 12 months, along with other great benefits.</li>
</ul>
</li>
<li>Git clone the Humidity Monitor App <a href="https://github.com/zemien/HumidityMonitor">source code from GitHub</a>. Make sure it builds successfully on Visual Studio 2017 before proceeding further. This helps validate you have all the required components.</li>
</ul>
<h1 id="humidity-logger-uwp">Humidity Logger (UWP)<a href="#humidity-logger-uwp" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>
<p>The Humidity Logger is a simple Windows 10 Universal Windows Platform app that reads the relative humidity sensor on the Sense HAT and uploads aggregated data to Azure Table Storage. This app can only run successfully on a Pi with Sense HAT even though you could launch it in any Windows 10 device.</p>
<h2 id="azure-table-storage">Azure Table Storage<a href="#azure-table-storage" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>We first need to create an Azure Table Storage table to load readings in. We will specify three pieces of information - the location of the sensor (e.g. “Lounge”) as the Partition Key, the UTC date time it was inserted as the Row Key, and the relative humidity reading as an integer.</p>
<p>The Row Key is inserted as the number of ticks before DateTime.Max. This results in a decrementing number that I call Reverse Ticks in the code. This was done because Azure Table Storage is a simple NoSQL storage solution that doesn&rsquo;t have advanced querying or indexing capabilities. It automatically orders records by Partition Key and Row Key in ascending order, which means the record with the smallest Row Key (i.e. the most recently inserted record) is at the top. This makes it trivial to select the latest reading as I just need to read the first record.</p>
<p>Here&rsquo;s the basic steps to get the Azure Table Storage up and running for the logger:</p>
<p>Log in to the <a href="https://portal.azure.com">Azure Portal</a> and click on the Add button to go to the Marketplace. Choose Storage account and specify options. I have gone with the cheapest options where possible, including Locally-redundant storage (LRS).</p>
<p><img class="alignnone wp-image-354 size-large" src="/wp-content/uploads/sites/2/2017/06/01-create-azure-table-storage.png" alt="Create storage account in Azure Portal" width="640" height="403" srcset="/wp-content/uploads/sites/2/2017/06/01-create-azure-table-storage.png 1024w, /wp-content/uploads/sites/2/2017/06/01-create-azure-table-storage.png 300w, /wp-content/uploads/sites/2/2017/06/01-create-azure-table-storage.png 768w" sizes="(max-width: 640px) 100vw, 640px" /></p>
<p>Next, go to Access keys and copy one of the connection strings. We will use this in two places in our code.</p>
<p><img class="alignnone wp-image-355 size-large" src="/wp-content/uploads/sites/2/2017/06/02-access-key.png" alt="Obtain connection string" width="640" height="373" srcset="/wp-content/uploads/sites/2/2017/06/02-access-key.png 1024w, /wp-content/uploads/sites/2/2017/06/02-access-key.png 300w, /wp-content/uploads/sites/2/2017/06/02-access-key.png 768w" sizes="(max-width: 640px) 100vw, 640px" /></p>
<h2 id="add-connection-strings">Add Connection Strings<a href="#add-connection-strings" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>The first place to add that Azure Table Storage connection string is in HumidityLogger\MainPage.xaml.cs in the SetUpAndLaunch() method:</p>
<div class="highlight"><pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="n">actions</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">AverageHumidityAction</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">new</span> <span class="n">TableStorageHumidityLogger</span><span class="p">(</span><span class="s">&#34;TODO - Location code&#34;</span><span class="p">,</span>
    <span class="s">&#34;TODO - Azure table storage connection string&#34;</span><span class="p">,</span> <span class="s">&#34;HumidityLog&#34;</span><span class="p">)));</span>
</code></pre></div><p>Also note the need for a Location code. This is used as the Partition Key in the table storage so keep it succinct, e.g. “Lounge”.</p>
<h2 id="deploy-to-raspberry-pi">Deploy to Raspberry Pi<a href="#deploy-to-raspberry-pi" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>I find debugging the application is the easiest way to deploy UWP apps onto the Pi. Once that&rsquo;s done, go into the Pi&rsquo;s <a href="https://developer.microsoft.com/en-us/windows/iot/docs/deviceportal">Windows Device Portal</a> and make it the default app to run on startup.</p>
<h1 id="humidity-monitor-api">Humidity Monitor API<a href="#humidity-monitor-api" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>
<p>I&rsquo;ve decided to create a .Net Core Web API from scratch, as opposed to using the Xamarin project template&rsquo;s option to generate a Web API backend. I&rsquo;ve kept the API very simple with only a few supported actions. The main logic revolves around converting DateTime requests to and from the ReverseTicks structure used as the Row Key. Unit tests validate the conversion logic.</p>
<h2 id="add-connection-strings-1">Add Connection Strings<a href="#add-connection-strings-1" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Paste the Azure Table Storage connection string from earlier into the HumidityController&rsquo;s constructor:</p>
<div class="highlight"><pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="n">HumidityController</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">storageAccount</span> <span class="p">=</span> <span class="n">CloudStorageAccount</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="s">&#34;TODO - Cloud table connection string&#34;</span><span class="p">);</span>
    <span class="n">_client</span> <span class="p">=</span> <span class="n">storageAccount</span><span class="p">.</span><span class="n">CreateCloudTableClient</span><span class="p">();</span>
    <span class="n">_tableName</span> <span class="p">=</span> <span class="s">&#34;HumidityLog&#34;</span><span class="p">;</span>
    <span class="n">_table</span> <span class="p">=</span> <span class="n">_client</span><span class="p">.</span><span class="n">GetTableReference</span><span class="p">(</span><span class="n">_tableName</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><h2 id="publish-to-azure-app-service">Publish to Azure App Service<a href="#publish-to-azure-app-service" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Go back to the Azure Portal and add a new App Service. Make sure to pick the Web App option, and not the Web App + SQL option.</p>
<p><img class="alignnone wp-image-358 size-large" src="/wp-content/uploads/sites/2/2017/06/05-add-app-service.png" alt="Add a new Azure Portal App Service" width="640" height="380" srcset="/wp-content/uploads/sites/2/2017/06/05-add-app-service.png 1024w, /wp-content/uploads/sites/2/2017/06/05-add-app-service.png 300w, /wp-content/uploads/sites/2/2017/06/05-add-app-service.png 768w, /wp-content/uploads/sites/2/2017/06/05-add-app-service.png 800w, /wp-content/uploads/sites/2/2017/06/05-add-app-service.png 1338w" sizes="(max-width: 640px) 100vw, 640px" /></p>
<p>Specify the App Service options. You may need to create new resource groups and app service plans here. Make sure to create a free App Service Plan to keep costs low. Turn on Application Insights.</p>
<p>Note the App name forms the URL of the API, e.g. humidity-monitor.azurewebsite.net for the example below:</p>
<p><img class="alignnone size-large wp-image-359" src="/wp-content/uploads/sites/2/2017/06/06-app-service-options.png" alt="Specify app service options" width="640" height="421" srcset="/wp-content/uploads/sites/2/2017/06/06-app-service-options.png 1024w, /wp-content/uploads/sites/2/2017/06/06-app-service-options.png 300w, /wp-content/uploads/sites/2/2017/06/06-app-service-options.png 768w" sizes="(max-width: 640px) 100vw, 640px" /></p>
<p>Head back to Visual Studio and use the Publish to Azure option. The UI looks a bit different in Windows but the general flow remains the same.</p>
<p><img class="alignnone size-medium wp-image-356" src="/wp-content/uploads/sites/2/2017/06/03-publish-to-azure-failure.png" alt="Right-click project and go to Publish > Publish to Azure" width="300" height="129" srcset="/wp-content/uploads/sites/2/2017/06/03-publish-to-azure-failure.png 300w, /wp-content/uploads/sites/2/2017/06/03-publish-to-azure-failure.png 768w, /wp-content/uploads/sites/2/2017/06/03-publish-to-azure-failure.png 898w" sizes="(max-width: 300px) 100vw, 300px" /><img class="alignnone size-large wp-image-360" src="/wp-content/uploads/sites/2/2017/06/07-publish-to-azure.png" alt="Publish to Azure App Service" width="640" height="431" srcset="/wp-content/uploads/sites/2/2017/06/07-publish-to-azure.png 1024w, /wp-content/uploads/sites/2/2017/06/07-publish-to-azure.png 300w, /wp-content/uploads/sites/2/2017/06/07-publish-to-azure.png 768w, /wp-content/uploads/sites/2/2017/06/07-publish-to-azure.png 1398w" sizes="(max-width: 640px) 100vw, 640px" /></p>
<p>Visual Studio 2017 has a <a href="https://developercommunity.visualstudio.com/content/problem/29118/visual-studio-2017-does-not-show-azure-subscriptio.html">known bug</a> where it doesn&rsquo;t detect your subscription. Please try the workarounds in that link if you encounter it.</p>
<h1 id="humidity-monitor-app">Humidity Monitor App<a href="#humidity-monitor-app" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>
<p>The mobile app is built on Xamarin.Forms cross-platform framework using MVVM pattern. I&rsquo;ve tried to keep everything within the Forms project and avoid platform-specific customisations where possible. I created the project on my Mac, which doesn&rsquo;t create a UWP variant. However there is no reason why it can&rsquo;t run on Windows 10 devices as well.</p>
<p>Anyone can create self-signed Android apps for self-distribution, but iOS apps require a developer account to generate valid certificates.</p>
<h2 id="configure-the-app">Configure the App<a href="#configure-the-app" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>The HumidityMonitorAppViewModel is the main view model driving the mobile app. It has a few important configurations to add in the class fields:</p>
<ul>
<li>_location: The location code (i.e. Partition Key)</li>
<li>TIMEZONE: The <a href="https://gist.github.com/jrolstad/5ca7d78dbfe182d7c1be">IANA time zone code according to NodaTime</a></li>
<li>_dal: Requires the base URL of the Humidity Monitor API deployed onto the App Service, e.g. <a href="http://humidity-monitor.azurewebsites.net">http://humidity-monitor.azurewebsites.net</a></li>
<li>(Optional) _switchDal: The IFTTT Maker Webhook key that you obtain from your IFTTT account</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">HumidityMonitorAppViewModel</span> <span class="p">:</span> <span class="n">ViewModelBase</span>
<span class="p">{</span>
    <span class="kt">string</span> <span class="n">_location</span> <span class="p">=</span> <span class="s">&#34;TODO - Location&#34;</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">TIMEZONE</span> <span class="p">=</span> <span class="s">&#34;TODO - IANA time zone code&#34;</span><span class="p">;</span>
    <span class="n">HumidityViewModel</span> <span class="n">_latestHumidity</span><span class="p">;</span>
    <span class="n">ObservableCollection</span><span class="p">&lt;</span><span class="n">HumidityViewModel</span><span class="p">&gt;</span> <span class="n">_detailedHumidityCollection</span><span class="p">;</span>
    <span class="n">ObservableCollection</span><span class="p">&lt;</span><span class="n">HumiditySummaryViewModel</span><span class="p">&gt;</span> <span class="n">_humiditySummaryCollection</span><span class="p">;</span>
    <span class="n">DateTime</span> <span class="n">_detailedHumidityDate</span><span class="p">;</span>
    <span class="n">DateTime</span> <span class="n">_humiditySummaryStartDate</span><span class="p">;</span>
    <span class="n">DateTime</span> <span class="n">_humiditySummaryEndDate</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">_canGetLatestHumidity</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">_isLoading</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">_viewSwitch</span><span class="p">;</span>
    <span class="n">ViewEnum</span> <span class="n">_currentView</span><span class="p">;</span>
    <span class="k">readonly</span> <span class="n">HumidityMonitorDAL</span> <span class="n">_dal</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HumidityMonitorDAL</span><span class="p">(</span><span class="s">&#34;TODO - Backend API base URI&#34;</span><span class="p">);</span>
    <span class="k">readonly</span> <span class="n">IftttDehumidifierSwitchDAL</span> <span class="n">_switchDal</span> <span class="p">=</span> <span class="k">new</span> <span class="n">IftttDehumidifierSwitchDAL</span><span class="p">(</span><span class="s">&#34;TODO - IFTTT Maker Webhook Key&#34;</span><span class="p">);</span>
    <span class="c1">//... more code here ...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></div><h2 id="create-android-signing-certificate">Create Android Signing Certificate<a href="#create-android-signing-certificate" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Follow <a href="https://developer.xamarin.com/guides/android/deployment,_testing,_and_metrics/publishing_an_application/part_2_-_signing_the_android_application_package/">Xamarin&rsquo;s guide to generate a self-signed Android certificate</a>. This is mandatory for the next step.</p>
<h2 id="cicd-with-azure-mobile-center">CI/CD with Azure Mobile Center<a href="#cicd-with-azure-mobile-center" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>This is an optional step but one that made my testing life easier because it automatically builds and distributes my Android app on every Git push. The <a href="https://mobile.azure.com">Azure Mobile Center</a> is currently in preview and is free to use. It hooks into your Azure account so make sure to sign in with your existing Azure credentials. There are many guides out there on how to configure CI/CD pipeline with the Mobile Center.</p>
<h1 id="next-steps-for-improvement">Next Steps for Improvement<a href="#next-steps-for-improvement" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>
<p>Here are some suggested improvements that you can try yourself:</p>
<ul>
<li>The Sense HAT has more sensors. Incorporate readings from different sensors, e.g. temperature and pressure, to derive further insights.</li>
<li>Improve security of the API because you wouldn&rsquo;t want everyone to be able to see your humidity readings.</li>
<li>Incorporate the IANA time zone code into the Table Storage so it doesn&rsquo;t need to be specified on every API call.</li>
<li>Make the location code configurable in the Humidity Logger UI and Xamarin app so that it can easily support different locations without changing hardcoded strings. The Xamarin app can then be extended to view records from different locations from a drop-down.</li>
<li>Create configurable notifications that will alert you if the humidity breaches a threshold. This will require building a background service that polls the API at specific intervals. A fancier solution is to do the monitoring on the backend (Azure Functions, maybe?) and send a push notification to the user.</li>
</ul>
<h1 id="conclusion">Conclusion<a href="#conclusion" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>
<p>The Humidity Monitor App has many components but I&rsquo;ve done most of the hard work. All you need is to configure some Azure resources and you&rsquo;re done. I&rsquo;ve also left enough gaps in the mobile app for you want to take this further. Enjoy!</p>

			</div>
			<hr class="post-end">
			<footer class="post-info">
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>1478 Words</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2017-06-28 23:42 &#43;1200</p>
			</footer>
		</article>
		<div class="post-nav thin">
			<a class="next-post" href="/the-little-things-matter/">
				<span class="post-nav-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>&nbsp;Newer</span><br><span>The Little Things Matter</span>
			</a>
			<a class="prev-post" href="/taking-shortcuts-make-us-look-stupid/">
				<span class="post-nav-label">Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><br><span>Taking Shortcuts Make Us Look Stupid</span>
			</a>
		</div>
		<div id="comments" class="thin">
</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2021 <a href="/">Shawn Lam</a> &#183; <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></p>
		<p>
			Made with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> &#183; Theme <a href="https://github.com/Track3/hermit" target="_blank" rel="noopener">Hermit</a> &#183; <a href="/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
		</p>
	</footer>



	<script src="/js/bundle.min.7d8545daa55d62427355498dd8da13f98ff79a7938ce7d2a5e2ae1ec0de3beb8.js" integrity="sha256-fYVF2qVdYkJzVUmN2NoT+Y/3mnk4zn0qXirh7A3jvrg=" crossorigin="anonymous"></script>
	
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-74441668-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</body>

</html>
